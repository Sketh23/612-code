\hypertarget{classPWM}{
\section{PWM Class Reference}
\label{classPWM}\index{PWM@{PWM}}
}


{\ttfamily \#include $<$PWM.h$>$}

Inheritance diagram for PWM:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=5.000000cm]{classPWM}
\end{center}
\end{figure}
\subsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries PeriodMultiplier} \{ {\bfseries kPeriodMultiplier\_\-1X} =  1, 
{\bfseries kPeriodMultiplier\_\-2X} =  2, 
{\bfseries kPeriodMultiplier\_\-4X} =  4
 \}
\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classPWM_aa96fde4003a2ee8c57f90019b2504009}{PWM} (UINT32 channel)
\item 
\hyperlink{classPWM_ac881a7f77ff1989debafd76005868d77}{PWM} (UINT8 moduleNumber, UINT32 channel)
\item 
virtual \hyperlink{classPWM_a903377c1da3618530f999d77297406af}{$\sim$PWM} ()
\item 
virtual void \hyperlink{classPWM_ae0916ef0dec0ad1e7793a16d3d6c42c3}{SetRaw} (UINT8 value)
\item 
virtual UINT8 \hyperlink{classPWM_a4fe28ee13017aa4c6b9b8fa662ebf99e}{GetRaw} ()
\item 
void \hyperlink{classPWM_a274fbac1ce527d1b08fab2ef4d66c35b}{SetPeriodMultiplier} (PeriodMultiplier mult)
\item 
void \hyperlink{classPWM_a9e3edb95ce8aefe94e2d0827798e62a1}{EnableDeadbandElimination} (bool eliminateDeadband)
\item 
void \hyperlink{classPWM_a57047fe0445577e94cebad0aa96165be}{SetBounds} (INT32 max, INT32 deadbandMax, INT32 center, INT32 deadbandMin, INT32 min)
\item 
\hypertarget{classPWM_a4cf5a893891d8fab4cafcecdd74516cb}{
UINT32 {\bfseries GetChannel} ()}
\label{classPWM_a4cf5a893891d8fab4cafcecdd74516cb}

\item 
\hypertarget{classPWM_a9dee53892735abde221e465882cf74c0}{
UINT32 {\bfseries GetModuleNumber} ()}
\label{classPWM_a9dee53892735abde221e465882cf74c0}

\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
virtual void \hyperlink{classPWM_a93e43862c48e9a06d95bd916b77c183a}{SetPosition} (float pos)
\item 
virtual float \hyperlink{classPWM_a2f5dcbf84dc82c4b19098c4cc99d0390}{GetPosition} ()
\item 
virtual void \hyperlink{classPWM_a947e5f6073da9e4d1b60db0c7791ca9c}{SetSpeed} (float speed)
\item 
virtual float \hyperlink{classPWM_a42b209cbe7e63732918cbbcb55bfaac7}{GetSpeed} ()
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classPWM_a80b83bf5f9751ceaf6439fccab8fe5d0}{
bool {\bfseries m\_\-eliminateDeadband}}
\label{classPWM_a80b83bf5f9751ceaf6439fccab8fe5d0}

\item 
\hypertarget{classPWM_a2494b8bdaa325b304c1f3ef9c2c0cf4f}{
INT32 {\bfseries m\_\-maxPwm}}
\label{classPWM_a2494b8bdaa325b304c1f3ef9c2c0cf4f}

\item 
\hypertarget{classPWM_ad679eaccdc7edfd3eb2c6b52f41669a9}{
INT32 {\bfseries m\_\-deadbandMaxPwm}}
\label{classPWM_ad679eaccdc7edfd3eb2c6b52f41669a9}

\item 
\hypertarget{classPWM_ae675cc802a52f61413ea64823e843f93}{
INT32 {\bfseries m\_\-centerPwm}}
\label{classPWM_ae675cc802a52f61413ea64823e843f93}

\item 
\hypertarget{classPWM_a51086c285825c581369217b0f4e4a527}{
INT32 {\bfseries m\_\-deadbandMinPwm}}
\label{classPWM_a51086c285825c581369217b0f4e4a527}

\item 
\hypertarget{classPWM_abceceb853052bcb9c84a79a6e034d368}{
INT32 {\bfseries m\_\-minPwm}}
\label{classPWM_abceceb853052bcb9c84a79a6e034d368}

\end{DoxyCompactItemize}
\subsection*{Static Protected Attributes}
\begin{DoxyCompactItemize}
\item 
static const UINT32 \hyperlink{classPWM_ad76e35266df11ca46f9792492671379a}{kDefaultPwmPeriod} = 774
\item 
static const UINT32 \hyperlink{classPWM_a6d481a094dc4d1df83cfd77b2d6bbf06}{kDefaultMinPwmHigh} = 102
\item 
\hypertarget{classPWM_a1128d7b7ad8cb6a4d3bb49ef4c08fbfa}{
static const INT32 {\bfseries kPwmDisabled} = 0}
\label{classPWM_a1128d7b7ad8cb6a4d3bb49ef4c08fbfa}

\end{DoxyCompactItemize}
\subsection*{Friends}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classPWM_aa15053da4e6cbe2d051a32116bcfbf2b}{
class \hyperlink{classPWM_aa15053da4e6cbe2d051a32116bcfbf2b}{DigitalModule}}
\label{classPWM_aa15053da4e6cbe2d051a32116bcfbf2b}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Class implements the \hyperlink{classPWM}{PWM} generation in the FPGA.

The values supplied as arguments for \hyperlink{classPWM}{PWM} outputs range from -\/1.0 to 1.0. They are mapped to the hardware dependent values, in this case 0-\/255 for the FPGA. Changes are immediately sent to the FPGA, and the update occurs at the next FPGA cycle. There is no delay.

As of revision 0.1.10 of the FPGA, the FPGA interprets the 0-\/255 values as follows:
\begin{DoxyItemize}
\item 255 = full \char`\"{}forward\char`\"{}
\item 254 to 129 = linear scaling from \char`\"{}full forward\char`\"{} to \char`\"{}center\char`\"{}
\item 128 = center value
\item 127 to 2 = linear scaling from \char`\"{}center\char`\"{} to \char`\"{}full reverse\char`\"{}
\item 1 = full \char`\"{}reverse\char`\"{}
\item 0 = disabled (i.e. \hyperlink{classPWM}{PWM} output is held low) 
\end{DoxyItemize}

\subsection{Constructor \& Destructor Documentation}
\hypertarget{classPWM_aa96fde4003a2ee8c57f90019b2504009}{
\index{PWM@{PWM}!PWM@{PWM}}
\index{PWM@{PWM}!PWM@{PWM}}
\subsubsection[{PWM}]{\setlength{\rightskip}{0pt plus 5cm}PWM::PWM (
\begin{DoxyParamCaption}
\item[{UINT32}]{channel}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}explicit\mbox{]}}}}
\label{classPWM_aa96fde4003a2ee8c57f90019b2504009}
Allocate a \hyperlink{classPWM}{PWM} in the default module given a channel.

Using a default module allocate a \hyperlink{classPWM}{PWM} given the channel number. The default module is the first slot numerically in the cRIO chassis.


\begin{DoxyParams}{Parameters}
{\em channel} & The \hyperlink{classPWM}{PWM} channel on the digital module. \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_ac881a7f77ff1989debafd76005868d77}{
\index{PWM@{PWM}!PWM@{PWM}}
\index{PWM@{PWM}!PWM@{PWM}}
\subsubsection[{PWM}]{\setlength{\rightskip}{0pt plus 5cm}PWM::PWM (
\begin{DoxyParamCaption}
\item[{UINT8}]{moduleNumber, }
\item[{UINT32}]{channel}
\end{DoxyParamCaption}
)}}
\label{classPWM_ac881a7f77ff1989debafd76005868d77}
Allocate a \hyperlink{classPWM}{PWM} given a module and channel. Allocate a \hyperlink{classPWM}{PWM} using a module and channel number.


\begin{DoxyParams}{Parameters}
{\em moduleNumber} & The digital module (1 or 2). \\
\hline
{\em channel} & The \hyperlink{classPWM}{PWM} channel on the digital module (1..10). \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_a903377c1da3618530f999d77297406af}{
\index{PWM@{PWM}!$\sim$PWM@{$\sim$PWM}}
\index{$\sim$PWM@{$\sim$PWM}!PWM@{PWM}}
\subsubsection[{$\sim$PWM}]{\setlength{\rightskip}{0pt plus 5cm}PWM::$\sim$PWM (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPWM_a903377c1da3618530f999d77297406af}
Free the \hyperlink{classPWM}{PWM} channel.

Free the resource associated with the \hyperlink{classPWM}{PWM} channel and set the value to 0. 

\subsection{Member Function Documentation}
\hypertarget{classPWM_a9e3edb95ce8aefe94e2d0827798e62a1}{
\index{PWM@{PWM}!EnableDeadbandElimination@{EnableDeadbandElimination}}
\index{EnableDeadbandElimination@{EnableDeadbandElimination}!PWM@{PWM}}
\subsubsection[{EnableDeadbandElimination}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::EnableDeadbandElimination (
\begin{DoxyParamCaption}
\item[{bool}]{eliminateDeadband}
\end{DoxyParamCaption}
)}}
\label{classPWM_a9e3edb95ce8aefe94e2d0827798e62a1}
Optionally eliminate the deadband from a speed controller. 
\begin{DoxyParams}{Parameters}
{\em eliminateDeadband} & If true, set the motor curve on the \hyperlink{classJaguar}{Jaguar} to eliminate the deadband in the middle of the range. Otherwise, keep the full range without modifying any values. \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_a2f5dcbf84dc82c4b19098c4cc99d0390}{
\index{PWM@{PWM}!GetPosition@{GetPosition}}
\index{GetPosition@{GetPosition}!PWM@{PWM}}
\subsubsection[{GetPosition}]{\setlength{\rightskip}{0pt plus 5cm}float PWM::GetPosition (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected, virtual\mbox{]}}}}
\label{classPWM_a2f5dcbf84dc82c4b19098c4cc99d0390}
Get the \hyperlink{classPWM}{PWM} value in terms of a position.

This is intended to be used by servos.

\begin{DoxyPrecond}{Precondition}
SetMaxPositivePwm() called. 

SetMinNegativePwm() called.
\end{DoxyPrecond}
\begin{DoxyReturn}{Returns}
The position the servo is set to between 0.0 and 1.0. 
\end{DoxyReturn}
\hypertarget{classPWM_a4fe28ee13017aa4c6b9b8fa662ebf99e}{
\index{PWM@{PWM}!GetRaw@{GetRaw}}
\index{GetRaw@{GetRaw}!PWM@{PWM}}
\subsubsection[{GetRaw}]{\setlength{\rightskip}{0pt plus 5cm}UINT8 PWM::GetRaw (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPWM_a4fe28ee13017aa4c6b9b8fa662ebf99e}
Get the \hyperlink{classPWM}{PWM} value directly from the hardware.

Read a raw value from a \hyperlink{classPWM}{PWM} channel.

\begin{DoxyReturn}{Returns}
Raw \hyperlink{classPWM}{PWM} control value. Range: 0 -\/ 255. 
\end{DoxyReturn}
\hypertarget{classPWM_a42b209cbe7e63732918cbbcb55bfaac7}{
\index{PWM@{PWM}!GetSpeed@{GetSpeed}}
\index{GetSpeed@{GetSpeed}!PWM@{PWM}}
\subsubsection[{GetSpeed}]{\setlength{\rightskip}{0pt plus 5cm}float PWM::GetSpeed (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected, virtual\mbox{]}}}}
\label{classPWM_a42b209cbe7e63732918cbbcb55bfaac7}
Get the \hyperlink{classPWM}{PWM} value in terms of speed.

This is intended to be used by speed controllers.

\begin{DoxyPrecond}{Precondition}
SetMaxPositivePwm() called. 

SetMinPositivePwm() called. 

SetMaxNegativePwm() called. 

SetMinNegativePwm() called.
\end{DoxyPrecond}
\begin{DoxyReturn}{Returns}
The most recently set speed between -\/1.0 and 1.0. 
\end{DoxyReturn}
\hypertarget{classPWM_a57047fe0445577e94cebad0aa96165be}{
\index{PWM@{PWM}!SetBounds@{SetBounds}}
\index{SetBounds@{SetBounds}!PWM@{PWM}}
\subsubsection[{SetBounds}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::SetBounds (
\begin{DoxyParamCaption}
\item[{INT32}]{max, }
\item[{INT32}]{deadbandMax, }
\item[{INT32}]{center, }
\item[{INT32}]{deadbandMin, }
\item[{INT32}]{min}
\end{DoxyParamCaption}
)}}
\label{classPWM_a57047fe0445577e94cebad0aa96165be}
Set the bounds on the \hyperlink{classPWM}{PWM} values. This sets the bounds on the \hyperlink{classPWM}{PWM} values for a particular each type of controller. The values determine the upper and lower speeds as well as the deadband bracket. 
\begin{DoxyParams}{Parameters}
{\em max} & The Minimum pwm value \\
\hline
{\em deadbandMax} & The high end of the deadband range \\
\hline
{\em center} & The center speed (off) \\
\hline
{\em deadbandMin} & The low end of the deadband range \\
\hline
{\em min} & The minimum pwm value \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_a274fbac1ce527d1b08fab2ef4d66c35b}{
\index{PWM@{PWM}!SetPeriodMultiplier@{SetPeriodMultiplier}}
\index{SetPeriodMultiplier@{SetPeriodMultiplier}!PWM@{PWM}}
\subsubsection[{SetPeriodMultiplier}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::SetPeriodMultiplier (
\begin{DoxyParamCaption}
\item[{PeriodMultiplier}]{mult}
\end{DoxyParamCaption}
)}}
\label{classPWM_a274fbac1ce527d1b08fab2ef4d66c35b}
Slow down the \hyperlink{classPWM}{PWM} signal for old devices.


\begin{DoxyParams}{Parameters}
{\em mult} & The period multiplier to apply to this channel \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_a93e43862c48e9a06d95bd916b77c183a}{
\index{PWM@{PWM}!SetPosition@{SetPosition}}
\index{SetPosition@{SetPosition}!PWM@{PWM}}
\subsubsection[{SetPosition}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::SetPosition (
\begin{DoxyParamCaption}
\item[{float}]{pos}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected, virtual\mbox{]}}}}
\label{classPWM_a93e43862c48e9a06d95bd916b77c183a}
Set the \hyperlink{classPWM}{PWM} value based on a position.

This is intended to be used by servos.

\begin{DoxyPrecond}{Precondition}
SetMaxPositivePwm() called. 

SetMinNegativePwm() called.
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em pos} & The position to set the servo between 0.0 and 1.0. \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_ae0916ef0dec0ad1e7793a16d3d6c42c3}{
\index{PWM@{PWM}!SetRaw@{SetRaw}}
\index{SetRaw@{SetRaw}!PWM@{PWM}}
\subsubsection[{SetRaw}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::SetRaw (
\begin{DoxyParamCaption}
\item[{UINT8}]{value}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classPWM_ae0916ef0dec0ad1e7793a16d3d6c42c3}
Set the \hyperlink{classPWM}{PWM} value directly to the hardware.

Write a raw value to a \hyperlink{classPWM}{PWM} channel.


\begin{DoxyParams}{Parameters}
{\em value} & Raw \hyperlink{classPWM}{PWM} value. Range 0 -\/ 255. \\
\hline
\end{DoxyParams}
\hypertarget{classPWM_a947e5f6073da9e4d1b60db0c7791ca9c}{
\index{PWM@{PWM}!SetSpeed@{SetSpeed}}
\index{SetSpeed@{SetSpeed}!PWM@{PWM}}
\subsubsection[{SetSpeed}]{\setlength{\rightskip}{0pt plus 5cm}void PWM::SetSpeed (
\begin{DoxyParamCaption}
\item[{float}]{speed}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected, virtual\mbox{]}}}}
\label{classPWM_a947e5f6073da9e4d1b60db0c7791ca9c}
Set the \hyperlink{classPWM}{PWM} value based on a speed.

This is intended to be used by speed controllers.

\begin{DoxyPrecond}{Precondition}
SetMaxPositivePwm() called. 

SetMinPositivePwm() called. 

SetCenterPwm() called. 

SetMaxNegativePwm() called. 

SetMinNegativePwm() called.
\end{DoxyPrecond}

\begin{DoxyParams}{Parameters}
{\em speed} & The speed to set the speed controller between -\/1.0 and 1.0. \\
\hline
\end{DoxyParams}


Reimplemented in \hyperlink{classSafePWM_af1ed936d88f3ee6446b01c17feb24b78}{SafePWM}.



\subsection{Member Data Documentation}
\hypertarget{classPWM_a6d481a094dc4d1df83cfd77b2d6bbf06}{
\index{PWM@{PWM}!kDefaultMinPwmHigh@{kDefaultMinPwmHigh}}
\index{kDefaultMinPwmHigh@{kDefaultMinPwmHigh}!PWM@{PWM}}
\subsubsection[{kDefaultMinPwmHigh}]{\setlength{\rightskip}{0pt plus 5cm}const UINT32 {\bf PWM::kDefaultMinPwmHigh} = 102\hspace{0.3cm}{\ttfamily  \mbox{[}static, protected\mbox{]}}}}
\label{classPWM_a6d481a094dc4d1df83cfd77b2d6bbf06}
kDefaultMinPwmHigh is \char`\"{}ticks\char`\"{} where each tick is 6.525us


\begin{DoxyItemize}
\item There are 128 pwm values less than the center, so...
\item The minimum output pulse length is 1.5ms -\/ 128 $\ast$ 6.525us = 0.665ms
\item 0.665ms / 6.525us per tick = 102 
\end{DoxyItemize}\hypertarget{classPWM_ad76e35266df11ca46f9792492671379a}{
\index{PWM@{PWM}!kDefaultPwmPeriod@{kDefaultPwmPeriod}}
\index{kDefaultPwmPeriod@{kDefaultPwmPeriod}!PWM@{PWM}}
\subsubsection[{kDefaultPwmPeriod}]{\setlength{\rightskip}{0pt plus 5cm}const UINT32 {\bf PWM::kDefaultPwmPeriod} = 774\hspace{0.3cm}{\ttfamily  \mbox{[}static, protected\mbox{]}}}}
\label{classPWM_ad76e35266df11ca46f9792492671379a}
kDefaultPwmPeriod is \char`\"{}ticks\char`\"{} where each tick is 6.525us


\begin{DoxyItemize}
\item 20ms periods (50 Hz) are the \char`\"{}safest\char`\"{} setting in that this works for all devices
\item 20ms periods seem to be desirable for Vex Motors
\item 20ms periods are the specified period for HS-\/322HD servos, but work reliably down to 10.0 ms; starting at about 8.5ms, the servo sometimes hums and get hot; by 5.0ms the hum is nearly continuous
\item 10ms periods work well for \hyperlink{classVictor}{Victor} 884
\item 5ms periods allows higher update rates for Luminary Micro \hyperlink{classJaguar}{Jaguar} speed controllers. Due to the shipping firmware on the \hyperlink{classJaguar}{Jaguar}, we can't run the update period less than 5.05 ms.
\end{DoxyItemize}

kDefaultPwmPeriod is the 1x period (5.05 ms). In hardware, the period scaling is implemented as an output squelch to get longer periods for old devices.

Set to 5.05 ms period / 6.525us clock = 774 

The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
PWM.h\item 
PWM.cpp\end{DoxyCompactItemize}
